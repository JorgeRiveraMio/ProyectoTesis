@model ProyectoTesis.Models.TBM_ESTUDIANTE
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    Layout = null;
    ViewData["Title"] = "Datos del Estudiante";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #ffffff;
            overflow: hidden;
            position: relative;
        }
        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(130px);
            opacity: 0.55;
            animation: float 16s ease-in-out infinite alternate;
            z-index: -1;
        }
        .blob-1 { width: 520px; height: 520px; background: #bae6fd; top: -150px; left: -120px; }
        .blob-2 { width: 340px; height: 340px; background: #7dd3fc; top: 10%; right: -100px; }
        .blob-3 { width: 420px; height: 420px; background: #60a5fa; bottom: 15%; left: 10%; }
        .blob-4 { width: 500px; height: 500px; background: #5eead4; bottom: -150px; right: 5%; }
        @@keyframes float {
            0%,100% { transform: translateY(0); }
            50% { transform: translateY(25px); }
        }
        input[type='radio']:checked + div {
            border-color: #2563eb;
            background-color: #2563eb10;
        }
        input[type='radio']:checked + div span {
            color: #2563eb;
        }
    </style>
</head>

<body class="flex items-center justify-center min-h-screen bg-white relative">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
    <div class="blob blob-4"></div>

    <div class="w-full max-w-lg px-6 py-10 relative z-10">
        <div class="bg-white rounded-2xl shadow-2xl p-8 border border-gray-100 backdrop-blur-sm bg-opacity-90">

            <div class="text-center mb-8">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Datos del Estudiante</h1>
                <p class="text-gray-500 mt-2 text-sm">Completa tu información para continuar con el test vocacional.</p>
            </div>

            <form asp-action="GuardarDatosEstudiante" method="post" id="formEstudiante" class="space-y-6" novalidate autocomplete="off">
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="IDD_SESION" />

                <!-- Nombre -->
                <div>
                    <label asp-for="NOM_COMPLETO" class="block text-sm font-medium text-gray-700 mb-2"></label>
                    <input asp-for="NOM_COMPLETO"
                           placeholder="Ingresa tu nombre completo"
                           maxlength="150"
                           autocomplete="off"
                           class="form-input w-full rounded-lg border-gray-300 bg-gray-50 
                                  text-gray-900 focus:ring-blue-500 focus:border-blue-500 transition"
                           oninput="this.value = this.value
                               .replace(/[^A-Za-zÁÉÍÓÚáéíóúÑñ\s]/g, '')
                               .replace(/\s{2,}/g, ' ')
                               .trimStart();" />
                    <span asp-validation-for="NOM_COMPLETO" class="text-red-500 text-sm"></span>
                </div>

                <!-- Edad -->
                <div>
                    <label asp-for="NUM_EDAD" class="block text-sm font-medium text-gray-700 mb-2"></label>
                    <input asp-for="NUM_EDAD"
                           type="text"
                           inputmode="numeric"
                           maxlength="3"
                           placeholder="Ingresa tu edad (12 a 100)"
                           autocomplete="off"
                           id="NUM_EDAD"
                           class="form-input w-full rounded-lg border-gray-300 bg-gray-50 
                                  text-gray-900 focus:ring-blue-500 focus:border-blue-500 transition"
                           oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/^0+/, '');" />
                    <span asp-validation-for="NUM_EDAD" class="text-red-500 text-sm"></span>
                </div>

                <!-- Género -->
                <div>
                    <label asp-for="NOM_GENERO" class="block text-sm font-medium text-gray-700 mb-3"></label>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        @foreach (var genero in new[] {
                            new { Valor = "Masculino", Icono = "male" },
                            new { Valor = "Femenino", Icono = "female" },
                            new { Valor = "Otro", Icono = "transgender" },
                            new { Valor = "Prefiero no decirlo", Icono = "help_outline" }
                        })
                        {
                            var isChecked = Model?.NOM_GENERO == genero.Valor ? "checked" : "";
                            <label class="relative cursor-pointer">
                                <input class="sr-only" type="radio" name="NOM_GENERO" value="@genero.Valor" @isChecked />
                                <div class="flex flex-col items-center justify-center w-full h-24 border-2 border-gray-300 
                                            rounded-lg text-center transition-all duration-200 
                                            hover:border-blue-400 hover:bg-blue-50">
                                    <span class="material-symbols-outlined text-4xl text-gray-500">@genero.Icono</span>
                                    <span class="mt-2 text-sm font-semibold text-gray-700">@genero.Valor</span>
                                </div>
                            </label>
                        }
                    </div>
                    <span asp-validation-for="NOM_GENERO" class="text-red-500 text-sm"></span>
                </div>

                <!-- Botones -->
                <div class="pt-4 flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0">
                    <a asp-action="Index"
                       class="w-full sm:w-auto flex-1 inline-flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm 
                              text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 
                              focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition">
                        Volver
                    </a>
                    <button type="submit"
                            class="w-full sm:w-auto flex-1 inline-flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm 
                                   text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none 
                                   focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition">
                        Continuar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>

    <script>
        $(function () {
            $("#formEstudiante").validate({
                rules: {
                    NOM_COMPLETO: {
                        required: true,
                        minlength: 3,
                        maxlength: 150,
                        pattern: /^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/
                    },
                    NUM_EDAD: {
                        required: true,
                        digits: true,
                        range: [12, 100]
                    },
                    NOM_GENERO: {
                        required: true
                    }
                },
                messages: {
                    NOM_COMPLETO: {
                        required: "El nombre es obligatorio.",
                        minlength: "Debe tener al menos 3 caracteres.",
                        maxlength: "Máximo 150 caracteres.",
                        pattern: "Solo se permiten letras y espacios."
                    },
                    NUM_EDAD: {
                        required: "La edad es obligatoria.",
                        digits: "Solo se permiten números enteros.",
                        range: "La edad debe estar entre 12 y 100 años."
                    },
                    NOM_GENERO: {
                        required: "Seleccione un género."
                    }
                },
                errorClass: "text-red-500 text-sm",
                errorPlacement: function (error, element) {
                    error.appendTo(element.parent());
                },
                highlight: function (element) {
                    $(element).addClass("border-red-400");
                },
                unhighlight: function (element) {
                    $(element).removeClass("border-red-400");
                }
            });

            // --- Entrada controlada sin bloqueo ---
            $("#NUM_EDAD").on("input", function () {
                let val = this.value.replace(/[^0-9]/g, '').replace(/^0+/, '');
                if (val.length > 3) val = val.substring(0, 3);
                this.value = val;

                // validación en vivo
                const edad = parseInt(val);
                const errorSpan = $(this).next("span[data-valmsg-for='NUM_EDAD']");
                if (val === "") {
                    errorSpan.text("La edad es obligatoria.");
                } else if (isNaN(edad) || edad < 12 || edad > 100) {
                    errorSpan.text("La edad debe estar entre 12 y 100 años.");
                } else {
                    errorSpan.text("");
                }
            });
        });
    </script>

</body>
</html>
